name: 'Python Linting & Formatting'
description: 'Run Python code quality checks: ruff, mypy, pylint, pydocstyle'
author: 'hope0hermes'

branding:
  icon: 'check-circle'
  color: 'blue'

inputs:
  python-version:
    description: 'Python version to use'
    required: false
    default: '3.12'

  working-directory:
    description: 'Directory containing the Python project'
    required: false
    default: '.'

  fail-fast:
    description: 'Stop on first error'
    required: false
    default: 'true'

outputs:
  status:
    description: 'Overall linting status (passed/failed)'
    value: ${{ steps.lint.outputs.status }}

runs:
  using: "composite"
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}

    - name: Install dependencies
      working-directory: ${{ inputs.working-directory }}
      shell: bash
      run: |
        echo "ðŸ“¦ Installing UV..."
        curl -LsSf https://astral.sh/uv/install.sh | sh
        echo "$HOME/.local/bin" >> $GITHUB_PATH

    - name: Run linting
      id: lint
      working-directory: ${{ inputs.working-directory }}
      shell: bash
      run: |
        echo "Running Python linting checks..."

        # Install dev dependencies with UV
        ~/.local/bin/uv sync --extra dev

        # Run linting tools directly
        if ~/.local/bin/uv run ruff check . && \
           ~/.local/bin/uv run mypy src/ 2>/dev/null; then
          echo "status=passed" >> $GITHUB_OUTPUT
          echo "âœ“ All linting checks passed"
        else
          echo "status=failed" >> $GITHUB_OUTPUT
          echo "âœ— Linting checks failed"
          exit 1
        fi
