# Reusable Create Release Workflow
#
# This workflow automatically creates a GitHub Release after a version bump PR is merged.
#
# Usage:
#   jobs:
#     create-release:
#       uses: hope0hermes/SharedWorkflows/.github/workflows/reusable-create-release.yml
#       secrets:
#         github-token: ${{ secrets.PAT_TOKEN }}  # Optional: Use PAT to trigger release events
#
# Note: If you want the release to trigger publish workflows, you must use a PAT.
#       Using GITHUB_TOKEN will not trigger subsequent workflow runs.

name: Reusable Create Release

on:
  workflow_call:
    secrets:
      github-token:
        description: 'GitHub token for creating release (use PAT to trigger release events)'
        required: false

jobs:
  create-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Extract version from commit
        id: extract
        uses: hope0hermes/SharedWorkflows/actions/extract-version@main

      - name: Create GitHub Release
        if: steps.extract.outputs.is_version_bump == 'true'
        uses: hope0hermes/SharedWorkflows/actions/create-github-release@main
        with:
          version: ${{ steps.extract.outputs.version }}
          github-token: ${{ secrets.github-token || secrets.GITHUB_TOKEN }}
